# terragrunt: install
parameters:
  - name: name
    type: string
  - name: displayName
    type: string
  - name: terragrunt_version
    type: string
    default: latest
    
steps:
  - task: Bash@3
    name: ${{ parameters.name }}
    displayName: ${{ parameters.displayName }}
    inputs:
      targetType: inline
      script: |
        set -e
 
        if [ "${{ parameters.terragrunt_version }}" = "latest" ]; then
          # Get latest version from GitHub API
          VERSION=$(curl -s --retry 3 --retry-delay 5 --max-time 10 https://api.github.com/repos/gruntwork-io/terragrunt/releases/latest | grep '"tag_name":' | sed -E 's/.*"([^"]+)".*/\1/')
        else
          VERSION="v${{ parameters.terragrunt_version }}"
        fi
  
        echo "Installing Terragrunt version: $VERSION"
  
        # Download terragrunt binary
        curl -L --retry 3 --retry-delay 5 --max-time 60 "https://github.com/gruntwork-io/terragrunt/releases/download/$VERSION/terragrunt_linux_amd64" -o terragrunt
  
        # Make executable and move to PATH
        chmod +x terragrunt
        sudo mv terragrunt /usr/local/bin/
